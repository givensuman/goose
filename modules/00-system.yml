# yaml-language-server: $schema=https://schema.blue-build.org/module-stage-list-v1.json
# This modules establishes the base of our image by running the Ultramarine
# migration script and include Universal Blue build steps.
modules:
  - type: dnf
    repos:
      cleanup: false
      nonfree: rpmfusion
    install:
      packages:
        - dnf-plugins-core

  - type: script
    snippets:
      - |
        dnf5 config-manager addrepo --from-repofile \
        https://github.com/terrapkg/subatomic-repos/raw/main/terra.repo
      - |
        dnf5 config-manager addrepo --from-repofile \
        https://download.docker.com/linux/fedora/docker-ce.repo

  - type: dnf
    repos:
      cleanup: true
      copr:
        - ublue-os/akmods
        - ublue-os/bazzite
        - ublue-os/packages
        - ublue-os/staging
    group-install:
      packages:
        - development-tools
    install:
      packages:
        # Universal Blue
        - uupd
        - ublue-os-media-automount-udev
        - ublue-os-just
        # Miscellaneous
        - firewall-config
        - gdisk
        - gparted
        - git
        - p7zip
        - p7zip-plugins
        - util-linux
        - wl-clipboard

  - type: systemd
    system:
      enabled:
        # Services installed above
        - uupd.timer
        # Services in /usr/lib/systemd/system
        - ublue-hostname.service
